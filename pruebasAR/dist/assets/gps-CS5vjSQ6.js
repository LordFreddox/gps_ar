(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const a of t)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function r(t){const a={};return t.integrity&&(a.integrity=t.integrity),t.referrerPolicy&&(a.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?a.credentials="include":t.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(t){if(t.ep)return;t.ep=!0;const a=r(t);fetch(t.href,a)}})();const P=navigator.userAgent.match(/iPhone|iPad|iPod/i);function D(n){const e=this;this.object=n,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation=null,this.screenOrientation=0,this.alphaOffset=0,this.initialOffset=null;const r=function({alpha:i,beta:s,gamma:c,webkitCompassHeading:l}){if(P){const d=360-l;e.alphaOffset=THREE.MathUtils.degToRad(d-i),e.deviceOrientation={alpha:i,beta:s,gamma:c,webkitCompassHeading:l}}else i<0&&(i+=360),e.deviceOrientation={alpha:i,beta:s,gamma:c};window.dispatchEvent(new CustomEvent("camera-rotation-change",{detail:{cameraRotation:n.rotation,WebkitCompassHeading:l}}))},o=function(){e.screenOrientation=window.orientation||0},t=(function(){window.addEventListener("orientationchange",o,!1),P?window.addEventListener("deviceorientation",r,!1):window.addEventListener("deviceorientationabsolute",r,!1)}).bind(this),a=function(){const i=new THREE.Vector3(0,0,1),s=new THREE.Euler,c=new THREE.Quaternion,l=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5));return function(d,h,m,u,w){s.set(m,h,-u,"YXZ"),d.setFromEuler(s),d.multiply(l),d.multiply(c.setFromAxisAngle(i,-w))}}();this.connect=function(){o(),window.DeviceOrientationEvent!==void 0&&typeof window.DeviceOrientationEvent.requestPermission=="function"?window.DeviceOrientationEvent.requestPermission().then(function(i){i=="granted"&&t()}).catch(function(i){console.error("THREE.AbsoluteDeviceOrientationControls: Unable to use DeviceOrientation API:",i)}):t(),e.enabled=!0},this.disconnect=function(){P?(window.removeEventListener("orientationchange",o,!1),window.removeEventListener("deviceorientation",r,!1)):(window.removeEventListener("orientationchange",o,!1),window.removeEventListener("deviceorientationabsolute",r,!1)),e.enabled=!1,e.initialOffset=!1,e.deviceOrientation=null},this.update=function({theta:i=0}={theta:0}){if(e.enabled===!1)return;const s=e.deviceOrientation;if(s){const c=s.alpha?THREE.MathUtils.degToRad(s.alpha):0,l=s.beta?THREE.MathUtils.degToRad(s.beta):0,d=s.gamma?THREE.MathUtils.degToRad(s.gamma):0,h=e.screenOrientation?THREE.MathUtils.degToRad(e.screenOrientation):0;if(P){const m=new THREE.Quaternion;a(m,c,l,d,h);const u=new THREE.Euler().setFromQuaternion(m,"YXZ");console.log(u.x,u.y,u.z),u.y=THREE.MathUtils.degToRad(360-s.webkitCompassHeading),m.setFromEuler(u),e.object.quaternion.copy(m)}else a(e.object.quaternion,c+i,l,d,h)}},this.updateAlphaOffset=function(){e.initialOffset=!1},this.dispose=function(){e.disconnect()},this.getAlpha=function(){const{deviceOrientation:i}=e;return i&&i.alpha?THREE.MathUtils.degToRad(i.alpha)+e.alphaOffset:0},this.getBeta=function(){const{deviceOrientation:i}=e;return i&&i.beta?THREE.MathUtils.degToRad(i.beta):0}}D.prototype=Object.assign(Object.create(THREE.EventDispatcher.prototype),{constructor:D});const G="https://as-siteit-pru.azurewebsites.net/api";function ee(n,e,r){return fetch(`${G}${n}`,{method:"GET",headers:{"Content-type":"application/json;charset=UTF-8",cli:"PUnity",companyId:r,uid:e,dataListPrizesArAround:"true"}})}function te(n,e,r,o){return fetch(`${G}${n}`,{method:"PATCH",body:JSON.stringify(o),headers:{"Content-type":"application/json;charset=UTF-8",cli:"PUnity",companyId:r,uid:e,dataCapturePrizeArAround:"true"}})}function ne(n,e){return new Promise((r,o)=>{ee("/gaming/prizes/ar",n,e).then(t=>t.json()).then(t=>r(t.data)).catch(t=>o(t))})}function ie(n,e,r){let o={id:r.id,state_id:1,date_captured:r.uuid_event};return new Promise((t,a)=>{te("/gaming/prizes/ar",n,e,o).then(i=>i.json()).then(i=>t(i)).catch(i=>a(i))})}let $=!0;const W=new URLSearchParams(window.location.search).get("BigSurfaceId")||"0",q=new URLSearchParams(window.location.search).get("uid")||"0";let E=null,L=[],f=[],R=[],k=[],O=0,B=1,S=0,C=!1;const j=document.getElementById("compassChild"),oe=document.getElementById("Points"),y=document.getElementsByClassName("Explorer")[0],b=document.getElementsByClassName("PrizeList")[0],N=document.getElementsByClassName("StartingTutorials")[0],_=document.getElementsByClassName("PrizeCaptureResume")[0],Q=document.getElementsByClassName("FinalScore")[0],Y=document.getElementsByClassName("GameOver")[0],re=document.getElementById("btnPrizeList"),I=document.getElementById("btnReturnToExplorer"),ae=document.getElementById("btnAceptPrize"),se=document.getElementById("BtnNextTutorial"),ce=document.getElementById("FinalScorePoints"),le=document.getElementById("BtnExitFinalScore"),de=document.getElementById("ShowPrizeListGameOver"),ue=document.getElementById("title_prizeCaptured"),me=document.getElementById("title_captured_prizeCaptured"),pe=document.getElementById("FinalPrizeCaptureAmountCurrentSession"),p=document.getElementById("Canvas"),g=new THREE.Scene,v=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,500),A=new THREE.WebGLRenderer({canvas:p}),F=new THREEx.LocationBased(g,v),he=new THREEx.WebcamRenderer(A),Ee=new THREE.AmbientLight(4210752);g.add(Ee);const ve=new THREE.DirectionalLight(16777215,1);g.add(ve);const ye=new THREE.GLTFLoader,U=new THREE.Raycaster,x=new THREE.Vector2;let M=new D(v);const fe=navigator.userAgent.match(/iPhone|iPad|iPod/i);function ge(){y.style.visibility="hidden",b.style.visibility="hidden",_.style.visibility="hidden",Q.style.visibility="hidden",N.style.visibility="visible",re.addEventListener("click",()=>{y.style.visibility="hidden",b.style.visibility="visible",document.getElementById("rewardList").style.display="flex"}),I.addEventListener("click",()=>{y.style.visibility="visible",b.style.visibility="hidden",document.getElementById("rewardList").style.display="none"}),de.addEventListener("click",()=>{Y.style.visibility="hidden",b.style.visibility="visible",document.getElementById("rewardList").style.display="flex",I.removeEventListener("click",()=>{}),I.style.display="none"}),ae.addEventListener("click",()=>{Le()||be()}),se.addEventListener("click",()=>{we()}),le.addEventListener("click",()=>{window.close()}),window.addEventListener("camera-rotation-change",n=>{fe?j.style.transform=`rotate(${n.detail.WebkitCompassHeading}deg)`:j.style.transform=`rotate(${-M.deviceOrientation.alpha}deg)`})}ge();function we(){const n=document.getElementsByClassName("tutorial"+B)[0],e=document.getElementsByClassName("tutorial"+(B+1))[0];if(n==null||e==null){y.style.visibility="visible",b.style.visibility="hidden",N.style.display="none",C=!0,M.connect();return}n.style.visibility="hidden",e.style.visibility="visible",B++}function be(){_.style.visibility="hidden",y.style.visibility="visible",C=!0}F.on("gpsupdate",function(n){$&&($=!1,Ce(n))});function Ce(n){ne(q,W).then(e=>{R=e.list_prizes_ar,f=e.detailsEvent,L=e.prizesAndPoints,E=e.brand;const r=L.filter(t=>t.idEvent===f[0].idEvent).length;let o=0;if(L.forEach(t=>{X("img/icon_trophy.svg",t.nombrePremio,t.mensajePremio,t.fechaCapturadoPremio,t.puntosPremio),o+=t.puntosPremio}),document.getElementById("GameOverTotalPoints").innerText=`+${o}`,r>=f[0].prizeLimit){N.style.display="none",Y.style.visibility="visible";return}document.getElementById("event_name").innerText=f[0].descriptionEvent,O=L.filter(t=>t.idEvent===f[0].idEvent).reduce((t,a)=>t+a.puntosPremio,0),document.getElementById("GSName").innerText=(E==null?void 0:E.name)||"",document.getElementById("LogoGS").setAttribute("src",(E==null?void 0:E.logo)||""),R.forEach(t=>{Te(n.coords,t)}),document.getElementById("maxPrizeCapture").innerText=`${R.length} objetos en total para cazar. ¡Suerte!`,document.getElementById("maxPrizeCaptureSmall").innerText=`${R.length}`}).catch(e=>{console.error("Error fetching prizes:",e)})}F.startGps();function Te(n,e){ye.load(e.url3d,function(r){const o=r.scene.children[0];o.userData.isInteractable=!0,o.userData.prizeData=e,o.userData.prizeData=e;const t=H(-1e-4,1e-4),a=H(-1e-4,1e-4);o.scale.set(3,3,3),F.add(o,n.longitude+a,n.latitude+t,H(-3,-3)),k.push(o)},void 0,function(r){console.error(r)})}function H(n,e){return Math.random()*(e-n)+n}window.addEventListener("touchstart",n=>{const e=n.touches[0];x.x=e.clientX/window.innerWidth*2-1,x.y=-(e.clientY/window.innerHeight)*2+1,U.setFromCamera(x,v);const r=U.intersectObjects(g.children,!0);if(r.length>0&&C){for(let o=0;o<r.length;o++)if(r[o].object.parent.userData.isInteractable){C=!1;const t=r[o].object.parent;S++,Pe(t);break}}});function Pe(n){ie(q,W,n.userData.prizeData),X("img/icon_trophy.svg",n.userData.prizeData.title,n.userData.prizeData.title_captured,(Date.now()/1e3).toString(),n.userData.prizeData.value_score),y.style.visibility="hidden",ue.innerText=n.userData.prizeData.title,me.innerText=n.userData.prizeData.title_captured,g.remove(n),O+=n.userData.prizeData.value_score,oe.innerText=`+${O}`,document.getElementsByClassName("PrizeCaptureResume")[0].style.visibility="visible"}function Le(){return S>=f[0].prizeLimit?(Q.style.visibility="visible",y.style.visibility="hidden",_.style.visibility="hidden",ce.innerText=`+${O}`,pe.innerText=`${S}`,C=!1,!0):!1}function V(){if(p.width!==p.clientWidth||p.height!==p.clientHeight){A.setSize(p.clientWidth,p.clientHeight,!1);const n=p.clientWidth/p.clientHeight;v.aspect=n,v.updateProjectionMatrix()}he.update(),M.update(),k.forEach(n=>{n.lookAt(v.position)}),A.render(g,v),requestAnimationFrame(V)}V();function X(n,e,r,o,t){const a=document.getElementById("TotalPointsFromAllEvents"),s=(a.innerHTML?parseInt(a.innerHTML.replace("+","")):0)+t;a.innerHTML=`+${s}`;const c=document.createElement("div");c.className="reward-item";const l=document.createElement("img");l.className="reward-icon",l.src=n,l.alt="trophy",c.appendChild(l);const d=document.createElement("div");d.className="parent-description",c.appendChild(d);const h=document.createElement("div");h.className="reward-title",h.textContent=e,d.appendChild(h);const m=document.createElement("div");m.className="reward-description",m.textContent=r,d.appendChild(m);const u=document.createElement("div");u.style.flex="1 1 20%",c.appendChild(u);const w=document.createElement("div");w.className="date-title",w.textContent="Capturado el día",u.appendChild(w);const T=document.createElement("div");if(T.className="date-capture",o!=null){const z=new Date(parseInt(o)*1e3),Z=("0"+z.getDate()).slice(-2),J=("0"+(z.getMonth()+1)).slice(-2),K=z.getFullYear();T.textContent=`${Z}/${J}/${K}`}else T.textContent="no hay fecha";u.appendChild(T),document.querySelector(".rewar_list").appendChild(c)}
