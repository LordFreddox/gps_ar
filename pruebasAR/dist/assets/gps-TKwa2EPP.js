(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function o(t){const r={};return t.integrity&&(r.integrity=t.integrity),t.referrerPolicy&&(r.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?r.credentials="include":t.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(t){if(t.ep)return;t.ep=!0;const r=o(t);fetch(t.href,r)}})();const R=navigator.userAgent.match(/iPhone|iPad|iPod/i);function N(n){const e=this;this.object=n,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation=null,this.screenOrientation=0,this.alphaOffset=0,this.initialOffset=null;const o=function({alpha:a,beta:s,gamma:l,webkitCompassHeading:d}){if(R){const u=360-d;e.alphaOffset=THREE.MathUtils.degToRad(u-a),e.deviceOrientation={alpha:a,beta:s,gamma:l,webkitCompassHeading:d}}else a<0&&(a+=360),e.deviceOrientation={alpha:a,beta:s,gamma:l};window.dispatchEvent(new CustomEvent("camera-rotation-change",{detail:{cameraRotation:n.rotation,WebkitCompassHeading:d}}))},i=function(){e.screenOrientation=window.orientation||0},t=(function(){window.addEventListener("orientationchange",i,!1),R?window.addEventListener("deviceorientation",o,!1):window.addEventListener("deviceorientationabsolute",o,!1)}).bind(this),r=function(){const a=new THREE.Vector3(0,0,1),s=new THREE.Euler,l=new THREE.Quaternion,d=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5));return function(u,h,p,E,b){s.set(p,h,-E,"YXZ"),u.setFromEuler(s),u.multiply(d),u.multiply(l.setFromAxisAngle(a,-b))}}();this.connect=function(){i(),window.DeviceOrientationEvent!==void 0&&typeof window.DeviceOrientationEvent.requestPermission=="function"?window.DeviceOrientationEvent.requestPermission().then(function(a){a=="granted"&&t()}).catch(function(a){console.error("THREE.AbsoluteDeviceOrientationControls: Unable to use DeviceOrientation API:",a)}):t(),e.enabled=!0},this.disconnect=function(){R?(window.removeEventListener("orientationchange",i,!1),window.removeEventListener("deviceorientation",o,!1)):(window.removeEventListener("orientationchange",i,!1),window.removeEventListener("deviceorientationabsolute",o,!1)),e.enabled=!1,e.initialOffset=!1,e.deviceOrientation=null},this.update=function({theta:a=0}={theta:0}){if(e.enabled===!1)return;const s=e.deviceOrientation;if(s){const l=s.alpha?THREE.MathUtils.degToRad(s.alpha):0,d=s.beta?THREE.MathUtils.degToRad(s.beta):0,u=s.gamma?THREE.MathUtils.degToRad(s.gamma):0,h=e.screenOrientation?THREE.MathUtils.degToRad(e.screenOrientation):0;if(R){const p=new THREE.Quaternion;r(p,l,d,u,h);const E=new THREE.Euler().setFromQuaternion(p,"YXZ");E.y=THREE.MathUtils.degToRad(360-s.webkitCompassHeading),p.setFromEuler(E),e.object.quaternion.copy(p)}else r(e.object.quaternion,l+a,d,u,h)}},this.updateAlphaOffset=function(){e.initialOffset=!1},this.dispose=function(){e.disconnect()},this.getAlpha=function(){const{deviceOrientation:a}=e;return a&&a.alpha?THREE.MathUtils.degToRad(a.alpha)+e.alphaOffset:0},this.getBeta=function(){const{deviceOrientation:a}=e;return a&&a.beta?THREE.MathUtils.degToRad(a.beta):0}}N.prototype=Object.assign(Object.create(THREE.EventDispatcher.prototype),{constructor:N});const Y="https://as-siteit-pru.azurewebsites.net/api";function ee(n,e,o){return fetch(`${Y}${n}`,{method:"GET",headers:{"Content-type":"application/json;charset=UTF-8",cli:"PUnity",companyId:o,uid:e,dataListPrizesArAround:"true"}})}function te(n,e,o,i){return fetch(`${Y}${n}`,{method:"PATCH",body:JSON.stringify(i),headers:{"Content-type":"application/json;charset=UTF-8",cli:"PUnity",companyId:o,uid:e,dataCapturePrizeArAround:"true"}})}function ne(n,e){return new Promise((o,i)=>{ee("/gaming/prizes/ar",n,e).then(t=>t.json()).then(t=>o(t.data)).catch(t=>i(t))})}function ie(n,e,o){let i={id:o.id,state_id:1,date_captured:o.uuid_event};return new Promise((t,r)=>{te("/gaming/prizes/ar",n,e,i).then(a=>a.json()).then(a=>t(a)).catch(a=>r(a))})}let G=!0;const w=new URLSearchParams(window.location.search).get("BigSurfaceId")||"0",P=new URLSearchParams(window.location.search).get("uid")||"0";let c=null,y=[],m=[],g=[],z=[],L=0,H=1,_=0,B=!1;const q=document.getElementById("compassChild"),oe=document.getElementById("Points"),T=document.getElementsByClassName("Explorer")[0],x=document.getElementsByClassName("PrizeList")[0],I=document.getElementsByClassName("StartingTutorials")[0],F=document.getElementsByClassName("PrizeCaptureResume")[0],ae=document.getElementsByClassName("FinalScore")[0],$=document.getElementsByClassName("GameOver")[0],re=document.getElementById("btnPrizeList"),D=document.getElementById("btnReturnToExplorer"),se=document.getElementById("btnAceptPrize"),ce=document.getElementById("BtnNextTutorial"),le=document.getElementById("FinalScorePoints"),de=document.getElementById("BtnExitFinalScore"),ue=document.getElementById("ShowPrizeListGameOver"),me=document.getElementById("title_prizeCaptured"),pe=document.getElementById("title_captured_prizeCaptured"),Ee=document.getElementById("FinalPrizeCaptureAmountCurrentSession"),f=document.getElementById("Canvas"),C=new THREE.Scene,v=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,500),W=new THREE.WebGLRenderer({canvas:f}),j=new THREEx.LocationBased(C,v),fe=new THREE.AmbientLight(4210752);C.add(fe);const he=new THREE.DirectionalLight(16777215,1);C.add(he);const ye=new THREE.GLTFLoader,Q=new THREE.Raycaster,A=new THREE.Vector2;let M=new N(v);const ge=navigator.userAgent.match(/iPhone|iPad|iPod/i);function ve(){const n=document.getElementsByClassName("FakeUser")[0];P==="0"||w==="0"?n.style.display="block":I.style.display="block",re.addEventListener("click",()=>{T.style.display="none",x.style.display="block",document.getElementById("rewardList").style.display="flex"}),D.addEventListener("click",()=>{T.style.display="block",x.style.display="none",document.getElementById("rewardList").style.display="none",z.forEach(e=>{e.visible=!0})}),ue.addEventListener("click",()=>{$.style.display="none",x.style.display="block",document.getElementById("rewardList").style.display="flex",D.removeEventListener("click",()=>{}),D.style.display="none"}),se.addEventListener("click",()=>{Le()||Pe()}),ce.addEventListener("click",()=>{we()}),de.addEventListener("click",()=>{window.close()}),document.getElementById("StartFakeUser").addEventListener("click",()=>{n.style.display="none",I.style.display="block"}),window.addEventListener("camera-rotation-change",e=>{ge?q.style.transform=`rotate(${e.detail.WebkitCompassHeading}deg)`:q.style.transform=`rotate(${-M.deviceOrientation.alpha}deg)`})}ve();function we(){const n=document.getElementsByClassName("tutorial"+H)[0],e=document.getElementsByClassName("tutorial"+(H+1))[0];if(n==null||e==null){T.style.display="block",x.style.display="none",I.style.display="none",B=!0,M.connect(),z.forEach(o=>{o.visible=!0});return}n.style.display="none",e.style.display="block",H++,navigator.geolocation&&j.startGps()}function Pe(){F.style.display="none",T.style.display="block",B=!0}j.on("gpsupdate",function(n){G&&(G=!1,console.log(n.coords.latitude,n.coords.longitude),P==="0"||w==="0"?Ce(n):Te(n))});function Te(n){ne(P,w).then(e=>{g=e.list_prizes_ar,m=e.detailsEvent,y=e.prizesAndPoints,c=e.brand;const o=y.filter(t=>t.idEvent===m[0].idEvent).length;let i=0;if(y.forEach(t=>{U("img/icon_trophy.svg",t.nombrePremio,t.mensajePremio,t.fechaCapturadoPremio,t.puntosPremio),i+=t.puntosPremio}),document.getElementById("GameOverTotalPoints").innerText=`+${i}`,o>=m[0].prizeLimit){I.style.display="none",$.style.display="block";return}document.getElementById("event_name").innerText=m[0].descriptionEvent,L=y.filter(t=>t.idEvent===m[0].idEvent).reduce((t,r)=>t+r.puntosPremio,0),document.getElementById("GSName").innerText=(c==null?void 0:c.name)||"",document.getElementById("LogoGS").setAttribute("src",(c==null?void 0:c.logo)||""),g.forEach(t=>{V(n.coords,t)}),document.getElementById("maxPrizeCapture").innerText=`${g.length} objetos en total para cazar. ¡Suerte!`,document.getElementById("maxPrizeCaptureSmall").innerText=`${g.length}`}).catch(e=>{console.error("Error fetching prizes:",e)})}function Ce(n){fetch("src/response.json").then(e=>(e.ok||console.log("Network response was not ok"),e.json())).then(e=>{g=e.data.list_prizes_ar,m=e.data.detailsEvent,y=e.data.prizesAndPoints,c=e.data.brand;const o=y.filter(t=>t.idEvent===m[0].idEvent).length;let i=0;if(y.forEach(t=>{U("img/icon_trophy.svg",t.nombrePremio,t.mensajePremio,t.fechaCapturadoPremio,t.puntosPremio),i+=t.puntosPremio}),document.getElementById("GameOverTotalPoints").innerText=`+${i}`,o>=m[0].prizeLimit){I.style.display="none",$.style.display="block";return}document.getElementById("event_name").innerText=m[0].descriptionEvent,L=y.filter(t=>t.idEvent===m[0].idEvent).reduce((t,r)=>t+r.puntosPremio,0),document.getElementById("GSName").innerText=(c==null?void 0:c.name)||"",document.getElementById("LogoGS").setAttribute("src",(c==null?void 0:c.logo)||""),g.forEach(t=>{V(n.coords,t)}),document.getElementById("maxPrizeCapture").innerText=`${g.length} objetos en total para cazar. ¡Suerte!`,document.getElementById("maxPrizeCaptureSmall").innerText=`${g.length}`}).catch(e=>{console.error("Error fetching local prizes:",e)})}function V(n,e){ye.load(e.url3d,function(o){const i=o.scene.children[0];i.userData.isInteractable=!0,i.userData.prizeData=e,i.userData.prizeData=e;const t=k(-1e-4,1e-4),r=k(-1e-4,1e-4);i.scale.set(3,3,3),j.add(i,n.longitude+r,n.latitude+t,k(-3,-3)),z.push(i),i.visible=!1},void 0,function(o){console.error(o)})}function k(n,e){return Math.random()*(e-n)+n}window.addEventListener("touchstart",n=>{const e=n.touches[0];A.x=e.clientX/window.innerWidth*2-1,A.y=-(e.clientY/window.innerHeight)*2+1,Q.setFromCamera(A,v);const o=Q.intersectObjects(C.children,!0);if(o.length>0&&B){for(let i=0;i<o.length;i++)if(o[i].object.parent.userData.isInteractable){B=!1;const t=o[i].object.parent;_++,be(t);break}}});function be(n){(P!=="0"||w!=="0")&&ie(P,w,n.userData.prizeData),U("img/icon_trophy.svg",n.userData.prizeData.title,n.userData.prizeData.title_captured,(Date.now()/1e3).toString(),n.userData.prizeData.value_score),T.style.display="none",me.innerText=n.userData.prizeData.title,pe.innerText=n.userData.prizeData.title_captured,C.remove(n),L+=n.userData.prizeData.value_score,oe.innerText=`+${L}`,F.style.display="block"}function Le(){return _>=m[0].prizeLimit?(ae.style.display="block",(P==="0"||w==="0")&&(document.getElementById("keepPlayingLogin").innerHTML="Si quires capturar y redimir más premios, inicia sesión en la app"),T.style.display="none",F.style.display="none",le.innerText=`+${L}`,Ee.innerText=`${_}`,B=!1,!0):!1}function X(){if(f.width!==f.clientWidth||f.height!==f.clientHeight){W.setSize(f.clientWidth,f.clientHeight,!1);const n=f.clientWidth/f.clientHeight;v.aspect=n,v.updateProjectionMatrix()}M.update(),z.forEach(n=>{n.lookAt(v.position)}),W.render(C,v),requestAnimationFrame(X)}X();function U(n,e,o,i,t){const r=document.getElementById("TotalPointsFromAllEvents"),s=(r.innerHTML?parseInt(r.innerHTML.replace("+","")):0)+t;r.innerHTML=`+${s}`;const l=document.createElement("div");l.className="reward-item";const d=document.createElement("img");d.className="reward-icon",d.src=n,d.alt="trophy",l.appendChild(d);const u=document.createElement("div");u.className="parent-description",l.appendChild(u);const h=document.createElement("div");h.className="reward-title",h.textContent=e,u.appendChild(h);const p=document.createElement("div");p.className="reward-description",p.textContent=o,u.appendChild(p);const E=document.createElement("div");E.style.flex="1 1 20%",l.appendChild(E);const b=document.createElement("div");b.className="date-title",b.textContent="Capturado el día",E.appendChild(b);const O=document.createElement("div");if(O.className="date-capture",i!=null){const S=new Date(parseInt(i)*1e3),Z=("0"+S.getDate()).slice(-2),J=("0"+(S.getMonth()+1)).slice(-2),K=S.getFullYear();O.textContent=`${Z}/${J}/${K}`}else O.textContent="no hay fecha";E.appendChild(O),document.querySelector(".rewar_list").appendChild(l)}
