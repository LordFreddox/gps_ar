(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function r(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(n){if(n.ep)return;n.ep=!0;const a=r(n);fetch(n.href,a)}})();const P=navigator.userAgent.match(/iPhone|iPad|iPod/i);function S(t){const e=this;this.object=t,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation=null,this.screenOrientation=0,this.alphaOffset=0,this.initialOffset=null;const r=function({alpha:o,beta:s,gamma:c,webkitCompassHeading:l}){if(P){const d=360-l;e.alphaOffset=THREE.MathUtils.degToRad(d-o),e.deviceOrientation={alpha:o,beta:s,gamma:c,webkitCompassHeading:l}}else o<0&&(o+=360),e.deviceOrientation={alpha:o,beta:s,gamma:c};window.dispatchEvent(new CustomEvent("camera-rotation-change",{detail:{cameraRotation:t.rotation,WebkitCompassHeading:l}}))},i=function(){e.screenOrientation=window.orientation||0},n=(function(){window.addEventListener("orientationchange",i,!1),P?window.addEventListener("deviceorientation",r,!1):window.addEventListener("deviceorientationabsolute",r,!1)}).bind(this),a=function(){const o=new THREE.Vector3(0,0,1),s=new THREE.Euler,c=new THREE.Quaternion,l=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5));return function(d,h,u,m,w){s.set(u,h,-m,"YXZ"),d.setFromEuler(s),d.multiply(l),d.multiply(c.setFromAxisAngle(o,-w))}}();this.connect=function(){i(),window.DeviceOrientationEvent!==void 0&&typeof window.DeviceOrientationEvent.requestPermission=="function"?window.DeviceOrientationEvent.requestPermission().then(function(o){o=="granted"&&n()}).catch(function(o){console.error("THREE.AbsoluteDeviceOrientationControls: Unable to use DeviceOrientation API:",o)}):n(),e.enabled=!0},this.disconnect=function(){P?(window.removeEventListener("orientationchange",i,!1),window.removeEventListener("deviceorientation",r,!1)):(window.removeEventListener("orientationchange",i,!1),window.removeEventListener("deviceorientationabsolute",r,!1)),e.enabled=!1,e.initialOffset=!1,e.deviceOrientation=null},this.update=function({theta:o=0}={theta:0}){if(e.enabled===!1)return;const s=e.deviceOrientation;if(s){const c=s.alpha?THREE.MathUtils.degToRad(s.alpha):0,l=s.beta?THREE.MathUtils.degToRad(s.beta):0,d=s.gamma?THREE.MathUtils.degToRad(s.gamma):0,h=e.screenOrientation?THREE.MathUtils.degToRad(e.screenOrientation):0;if(P){const u=new THREE.Quaternion;a(u,c,l,d,h);const m=new THREE.Euler().setFromQuaternion(u,"YXZ");m.y=THREE.MathUtils.degToRad(360-s.webkitCompassHeading),u.setFromEuler(m),e.object.quaternion.copy(u)}else a(e.object.quaternion,c+o,l,d,h)}},this.updateAlphaOffset=function(){e.initialOffset=!1},this.dispose=function(){e.disconnect()},this.getAlpha=function(){const{deviceOrientation:o}=e;return o&&o.alpha?THREE.MathUtils.degToRad(o.alpha)+e.alphaOffset:0},this.getBeta=function(){const{deviceOrientation:o}=e;return o&&o.beta?THREE.MathUtils.degToRad(o.beta):0}}S.prototype=Object.assign(Object.create(THREE.EventDispatcher.prototype),{constructor:S});const W="https://as-siteit-pru.azurewebsites.net/api";function ee(t,e,r){return fetch(`${W}${t}`,{method:"GET",headers:{"Content-type":"application/json;charset=UTF-8",cli:"PUnity",companyId:r,uid:e,dataListPrizesArAround:"true"}})}function te(t,e,r,i){return fetch(`${W}${t}`,{method:"PATCH",body:JSON.stringify(i),headers:{"Content-type":"application/json;charset=UTF-8",cli:"PUnity",companyId:r,uid:e,dataCapturePrizeArAround:"true"}})}function ne(t,e){return new Promise((r,i)=>{ee("/gaming/prizes/ar",t,e).then(n=>n.json()).then(n=>r(n.data)).catch(n=>i(n))})}function ie(t,e,r){let i={id:r.id,state_id:1,date_captured:r.uuid_event};return new Promise((n,a)=>{te("/gaming/prizes/ar",t,e,i).then(o=>o.json()).then(o=>n(o)).catch(o=>a(o))})}let j=!0;const q=new URLSearchParams(window.location.search).get("BigSurfaceId")||"0",k=new URLSearchParams(window.location.search).get("uid")||"0";let E=null,L=[],y=[],R=[],z=[],O=0,I=1,A=0,C=!1;const U=document.getElementById("compassChild"),oe=document.getElementById("Points"),v=document.getElementsByClassName("Explorer")[0],b=document.getElementsByClassName("PrizeList")[0],_=document.getElementsByClassName("StartingTutorials")[0],F=document.getElementsByClassName("PrizeCaptureResume")[0],Q=document.getElementsByClassName("FinalScore")[0],Y=document.getElementsByClassName("GameOver")[0],re=document.getElementById("btnPrizeList"),x=document.getElementById("btnReturnToExplorer"),ae=document.getElementById("btnAceptPrize"),se=document.getElementById("BtnNextTutorial"),ce=document.getElementById("FinalScorePoints"),le=document.getElementById("BtnExitFinalScore"),de=document.getElementById("ShowPrizeListGameOver"),ue=document.getElementById("title_prizeCaptured"),me=document.getElementById("title_captured_prizeCaptured"),pe=document.getElementById("FinalPrizeCaptureAmountCurrentSession"),p=document.getElementById("Canvas"),g=new THREE.Scene,f=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,500),N=new THREE.WebGLRenderer({canvas:p}),M=new THREEx.LocationBased(g,f),he=new THREEx.WebcamRenderer(N),Ee=new THREE.AmbientLight(4210752);g.add(Ee);const fe=new THREE.DirectionalLight(16777215,1);g.add(fe);const ve=new THREE.GLTFLoader,G=new THREE.Raycaster,H=new THREE.Vector2;let $=new S(f);const ye=navigator.userAgent.match(/iPhone|iPad|iPod/i);function ge(){v.style.visibility="hidden",b.style.visibility="hidden",F.style.visibility="hidden",Q.style.visibility="hidden",_.style.visibility="visible",re.addEventListener("click",()=>{v.style.visibility="hidden",b.style.visibility="visible",document.getElementById("rewardList").style.display="flex"}),x.addEventListener("click",()=>{v.style.visibility="visible",b.style.visibility="hidden",document.getElementById("rewardList").style.display="none",z.forEach(t=>{t.visible=!0})}),de.addEventListener("click",()=>{Y.style.visibility="hidden",b.style.visibility="visible",document.getElementById("rewardList").style.display="flex",x.removeEventListener("click",()=>{}),x.style.display="none"}),ae.addEventListener("click",()=>{Le()||be()}),se.addEventListener("click",()=>{we()}),le.addEventListener("click",()=>{window.close()}),window.addEventListener("camera-rotation-change",t=>{ye?U.style.transform=`rotate(${t.detail.WebkitCompassHeading}deg)`:U.style.transform=`rotate(${-$.deviceOrientation.alpha}deg)`})}ge();function we(){const t=document.getElementsByClassName("tutorial"+I)[0],e=document.getElementsByClassName("tutorial"+(I+1))[0];if(t==null||e==null){v.style.visibility="visible",b.style.visibility="hidden",_.style.display="none",C=!0,$.connect(),z.forEach(r=>{r.visible=!0});return}t.style.visibility="hidden",e.style.visibility="visible",I++,navigator.geolocation&&M.startGps()}function be(){F.style.visibility="hidden",v.style.visibility="visible",C=!0}M.on("gpsupdate",function(t){j&&(j=!1,console.log(t.coords.latitude,t.coords.longitude),Ce(t))});function Ce(t){ne(k,q).then(e=>{R=e.list_prizes_ar,y=e.detailsEvent,L=e.prizesAndPoints,E=e.brand;const r=L.filter(n=>n.idEvent===y[0].idEvent).length;let i=0;if(L.forEach(n=>{X("img/icon_trophy.svg",n.nombrePremio,n.mensajePremio,n.fechaCapturadoPremio,n.puntosPremio),i+=n.puntosPremio}),document.getElementById("GameOverTotalPoints").innerText=`+${i}`,r>=y[0].prizeLimit){_.style.display="none",Y.style.visibility="visible";return}document.getElementById("event_name").innerText=y[0].descriptionEvent,O=L.filter(n=>n.idEvent===y[0].idEvent).reduce((n,a)=>n+a.puntosPremio,0),document.getElementById("GSName").innerText=(E==null?void 0:E.name)||"",document.getElementById("LogoGS").setAttribute("src",(E==null?void 0:E.logo)||""),R.forEach(n=>{Te(t.coords,n)}),document.getElementById("maxPrizeCapture").innerText=`${R.length} objetos en total para cazar. ¡Suerte!`,document.getElementById("maxPrizeCaptureSmall").innerText=`${R.length}`}).catch(e=>{console.error("Error fetching prizes:",e)})}function Te(t,e){ve.load(e.url3d,function(r){const i=r.scene.children[0];i.userData.isInteractable=!0,i.userData.prizeData=e,i.userData.prizeData=e;const n=D(-1e-4,1e-4),a=D(-1e-4,1e-4);i.scale.set(3,3,3),M.add(i,t.longitude+a,t.latitude+n,D(-3,-3)),z.push(i),i.visible=!1},void 0,function(r){console.error(r)})}function D(t,e){return Math.random()*(e-t)+t}window.addEventListener("touchstart",t=>{const e=t.touches[0];H.x=e.clientX/window.innerWidth*2-1,H.y=-(e.clientY/window.innerHeight)*2+1,G.setFromCamera(H,f);const r=G.intersectObjects(g.children,!0);if(r.length>0&&C){for(let i=0;i<r.length;i++)if(r[i].object.parent.userData.isInteractable){C=!1;const n=r[i].object.parent;A++,Pe(n);break}}});function Pe(t){ie(k,q,t.userData.prizeData),X("img/icon_trophy.svg",t.userData.prizeData.title,t.userData.prizeData.title_captured,(Date.now()/1e3).toString(),t.userData.prizeData.value_score),v.style.visibility="hidden",ue.innerText=t.userData.prizeData.title,me.innerText=t.userData.prizeData.title_captured,g.remove(t),O+=t.userData.prizeData.value_score,oe.innerText=`+${O}`,document.getElementsByClassName("PrizeCaptureResume")[0].style.visibility="visible"}function Le(){return A>=y[0].prizeLimit?(Q.style.visibility="visible",v.style.visibility="hidden",F.style.visibility="hidden",ce.innerText=`+${O}`,pe.innerText=`${A}`,C=!1,!0):!1}function V(){if(p.width!==p.clientWidth||p.height!==p.clientHeight){N.setSize(p.clientWidth,p.clientHeight,!1);const t=p.clientWidth/p.clientHeight;f.aspect=t,f.updateProjectionMatrix()}he.update(),$.update(),z.forEach(t=>{t.lookAt(f.position)}),N.render(g,f),requestAnimationFrame(V)}V();function X(t,e,r,i,n){const a=document.getElementById("TotalPointsFromAllEvents"),s=(a.innerHTML?parseInt(a.innerHTML.replace("+","")):0)+n;a.innerHTML=`+${s}`;const c=document.createElement("div");c.className="reward-item";const l=document.createElement("img");l.className="reward-icon",l.src=t,l.alt="trophy",c.appendChild(l);const d=document.createElement("div");d.className="parent-description",c.appendChild(d);const h=document.createElement("div");h.className="reward-title",h.textContent=e,d.appendChild(h);const u=document.createElement("div");u.className="reward-description",u.textContent=r,d.appendChild(u);const m=document.createElement("div");m.style.flex="1 1 20%",c.appendChild(m);const w=document.createElement("div");w.className="date-title",w.textContent="Capturado el día",m.appendChild(w);const T=document.createElement("div");if(T.className="date-capture",i!=null){const B=new Date(parseInt(i)*1e3),Z=("0"+B.getDate()).slice(-2),J=("0"+(B.getMonth()+1)).slice(-2),K=B.getFullYear();T.textContent=`${Z}/${J}/${K}`}else T.textContent="no hay fecha";m.appendChild(T),document.querySelector(".rewar_list").appendChild(c)}
